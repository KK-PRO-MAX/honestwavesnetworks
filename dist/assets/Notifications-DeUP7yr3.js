import{_ as Z,r as m,c as ee,o as te,a as y,b as g,d as a,e as o,w as r,u as n,E as _,f as se,g as u,n as D,h as p,i as x,s as ae,j as oe,k as ne,F as E,l as I,m as j,p as ie,t as v}from"./index-COfldkwK.js";import{a as le}from"./index-B9ygI19o.js";const k=le.create({baseURL:"https://guiz.haomengwl.com/api",timeout:1e4,headers:{"Content-Type":"application/json"}});k.interceptors.request.use(l=>{const i=localStorage.getItem("token");return i&&(l.headers.token=i),l},l=>(console.error("请求拦截器错误:",l),Promise.reject(l)));k.interceptors.response.use(l=>l,l=>(console.error("响应拦截器错误:",l),Promise.reject(l)));function re(l={}){return k.post("/Messagecenter/getlist",l)}const ce={class:"notifications-page"},de={class:"filter-section"},ue={class:"top-layout"},pe={class:"sort-group"},ve={class:"middle-area"},fe={class:"import-export-group"},me={class:"top-right"},ye={class:"notifications-list"},ge={class:"item-left"},_e={class:"top-row"},be={class:"bay-section"},he={class:"content-section"},Ce={class:"user-info-container"},Ne={class:"user-name"},we={class:"device-info"},ke={class:"item-right"},Se={class:"action-btns"},Ae={class:"item-time"},De={__name:"Notifications",setup(l){const i=m([]),f=m("priority"),b=m(""),h=m(""),S=m(!1),L=s=>s?s.split(/(?=Device:|SN:|NFC:|Charging:|Damage:)/).filter(e=>e.trim()!==""):[],T=ee(()=>{let s=[...i.value];if(h.value,f.value==="priority"?s.sort((e,t)=>t.id-e.id):s.sort((e,t)=>new Date(t.date_str)-new Date(e.date_str)),b.value.trim()){const e=b.value.toLowerCase();s=s.filter(t=>t.user_name.toLowerCase().includes(e)||t.bay_num.toString().includes(e)||t.title.toLowerCase().includes(e)||t.other_connect.toLowerCase().includes(e))}return s}),C=async()=>{S.value=!0;try{const s={};h.value,f.value==="time"?s.sort="desc":s.sort="asc";const e=await re(s);if(e.data.ret===0){let t=e.data.ret_data;if(typeof t=="string")try{t=JSON.parse(t)}catch(d){console.error("解析通知数据失败:",d),t=[]}i.value=Array.isArray(t)?t:[]}else j.error(e.data.msg||"获取通知列表失败"),i.value=[]}catch(s){console.error("获取通知列表异常:",s),j.error("获取通知列表异常"),i.value=[]}finally{S.value=!1}},A=s=>{f.value=s,C()},U=()=>{C()},B=()=>{i.value=[]},O=s=>{i.value.splice(s,1)},V=s=>{console.log("打开Bay:",s)},F=s=>{const e=s.raw,t=new FileReader;t.onload=d=>{try{const c=JSON.parse(d.target.result);Array.isArray(c)&&(i.value=[...i.value,...c])}catch{const M=d.target.result.split(`
`).slice(1).filter(w=>w.trim()).map(w=>{const[$,P,z,J,q,K,Y,G,H,Q,W,X]=w.split(",");return{content:$||"",user:P||"",time:z||"",date:J||"",priority:Number(q)||1,bayNumber:Number(K)||0,deviceTypeID:Y||"",deviceName:G||"",serialNumber:H||"",nfcTag:Q||"",chargingStatus:W||"Unknown",damageStatus:X||"Unknown"}});i.value=[...i.value,...M]}},t.readAsText(e)},R=()=>{const e=[["content","user","time","date","priority","bayNumber","deviceTypeID","deviceName","serialNumber","nfcTag","chargingStatus","damageStatus"].join(","),...i.value.map(N=>Object.values(N).join(","))].join(`
`),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(t),c=document.createElement("a");c.href=d,c.download=`notifications_${new Date().toISOString().slice(0,10)}.csv`,c.click(),URL.revokeObjectURL(d)};return te(()=>{C()}),(s,e)=>(g(),y("div",ce,[e[13]||(e[13]=a("h1",{class:"page-title"},"Notifications",-1)),a("div",de,[o(n(se),{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"All Categories",clearable:"",style:{width:"200px"},onChange:C},{default:r(()=>[o(n(_),{label:"All Categories",value:""}),o(n(_),{label:"A1",value:"A1"}),o(n(_),{label:"A2",value:"A2"}),o(n(_),{label:"A3",value:"A3"}),o(n(_),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),a("div",ue,[a("div",pe,[o(n(p),{type:"primary",plain:"",class:D({"active-sort":f.value==="priority"}),onClick:e[1]||(e[1]=t=>A("priority"))},{default:r(()=>[...e[4]||(e[4]=[u(" Prioritization sorting ",-1)])]),_:1},8,["class"]),o(n(p),{type:"default",plain:"",class:D({"active-sort":f.value==="time"}),onClick:e[2]||(e[2]=t=>A("time"))},{default:r(()=>[...e[5]||(e[5]=[u(" Time sorting ",-1)])]),_:1},8,["class"])]),a("div",ve,[o(n(oe),{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),placeholder:"Search user, device info, bay number, status...",class:"search-input",onInput:U},{prefix:r(()=>[o(n(x),{class:"search-icon"},{default:r(()=>[o(n(ae))]),_:1})]),_:1},8,["modelValue"]),a("div",fe,[o(n(ne),{class:"upload-btn",action:"#","auto-upload":!1,"on-change":F,accept:".csv,.json"},{default:r(()=>[o(n(p),{type:"success",plain:""},{default:r(()=>[...e[6]||(e[6]=[u("Import File",-1)])]),_:1})]),_:1}),o(n(p),{type:"primary",plain:"",onClick:R},{default:r(()=>[...e[7]||(e[7]=[u("Export File",-1)])]),_:1})])]),a("div",me,[e[9]||(e[9]=a("div",{class:"system-time"},[a("div",null,"12:52:21 PM"),a("div",null,"May 6th, 2025")],-1)),o(n(p),{style:{"background-color":"#FF0400","font-weight":"700"},type:"danger",onClick:B},{default:r(()=>[...e[8]||(e[8]=[u("Clear All",-1)])]),_:1})])]),a("div",ye,[(g(!0),y(E,null,I(T.value,(t,d)=>(g(),y("div",{key:t.id,class:"notification-item"},[a("div",ge,[a("div",_e,[a("div",be,[o(n(x),null,{default:r(()=>[o(n(ie))]),_:1}),u(" BAY "+v(t.bay_num),1)]),a("div",he,v(t.title),1)]),a("div",Ce,[e[10]||(e[10]=a("div",{class:"user-label"},"USER",-1)),a("div",Ne,v(t.user_name),1)]),a("div",we,[(g(!0),y(E,null,I(L(t.other_connect),(c,N)=>(g(),y("span",{key:N},v(c),1))),128))])]),a("div",ke,[a("div",Se,[o(n(p),{type:"primary",plain:"",onClick:c=>V(t)},{default:r(()=>[...e[11]||(e[11]=[u(" Open Bay ",-1)])]),_:1},8,["onClick"]),o(n(p),{type:"default",plain:"",onClick:c=>O(d)},{default:r(()=>[...e[12]||(e[12]=[u(" Dismiss ",-1)])]),_:1},8,["onClick"])]),a("div",Ae,[a("div",null,v(t.time_str),1),a("div",null,v(t.date_str),1)])])]))),128))])]))}},Ie=Z(De,[["__scopeId","data-v-0a5d4f4a"]]);export{Ie as default};

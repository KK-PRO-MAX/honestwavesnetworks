import{_ as P,J as Q,r as L,c as B,o as X,v as Y,a as C,b as y,d as a,t as p,u as n,e as l,j as Z,w as c,g as v,h,E as _,f as ee,F as te,l as se,y as N,G as ae,n as U,i as ne,a6 as le,a7 as oe,m,I as re}from"./index-COfldkwK.js";import{u as de}from"./departmentStore-CZLnaYq0.js";import{u as ce}from"./filterStore-wW98jmOu.js";import"./index-B9ygI19o.js";const ie={class:"page-wrapper"},ue={class:"header-row"},pe={class:"page-title"},me={class:"header-actions"},ge={class:"filter-section"},fe={class:"departments-grid"},ye={class:"card-content"},ve={class:"card-row-two-cols first-row"},he={class:"left-section"},_e={class:"value"},xe={class:"right-section"},be={class:"value"},we={class:"card-row-two-cols"},Ce={class:"left-section"},De={class:"bays-wrapper"},ke={class:"bays-first-line"},Be={key:0,class:"bays-expanded"},Ae={class:"right-section"},Ee={class:"value-large"},Ie={class:"button-row"},Se={__name:"Departments",setup(Te){const A=Q(),o=de(),E=ce(),g=L("");let I=null;const f=B({get:()=>E.selectedCategory,set:s=>E.setCategory(s)}),M=B(()=>o.departments),R=s=>{const e=T.value[s],t=o.departments.findIndex(d=>d===e);t!==-1&&(o.departments[t].expanded=!o.departments[t].expanded)},S=s=>s?s.length>25:!1,j=s=>!s||s.length<=25?s:s.substring(0,25)+"...",T=B(()=>{let s=[...M.value];if(f.value&&(s=s.filter(e=>e.category===f.value)),g.value.trim()){const e=g.value.toLowerCase().trim();s=s.filter(t=>t.name.toLowerCase().includes(e)||t.assignedBays.includes(e)||t.devices.includes(e))}return s}),V=L(null),q=()=>{clearTimeout(I),I=setTimeout(()=>{console.log("æœç´¢å…³é”®è¯:",g.value)},300)},z=()=>{console.log("åˆ†ç±»å˜æ›´:",f.value)},W=()=>{var s;(s=V.value)==null||s.click()},O=async s=>{const e=s.target.files[0];if(!e)return;const t=new FileReader;t.onload=d=>{var r,x,i,F;try{const D=d.target.result;if(e.name.endsWith(".csv")){const k=D.split(`
`),b=[];for(let u=1;u<k.length;u++)if(k[u].trim()){const w=k[u].split(",");b.push({name:((r=w[0])==null?void 0:r.trim())||"",assignedBays:((x=w[1])==null?void 0:x.trim())||"",devices:((i=w[2])==null?void 0:i.trim())||"",category:((F=w[3])==null?void 0:F.trim())||"A1"})}b.length>0&&(o.departments.length=0,b.forEach(u=>o.addDepartment(u)),m.success(`Successfully imported ${b.length} records`))}else(e.name.endsWith(".xlsx")||e.name.endsWith(".xls"))&&m.warning("Excel file import requires installing the xlsx library. Please use CSV format or install the xlsx library.")}catch(D){console.error("Import failed:",D),m.error("File import failed, please check the file format")}},t.readAsText(e),s.target.value=""},G=()=>{const s="Department,Assigned Bays,Bays Total,Category",e=o.departments.map(i=>`${i.name},${i.assignedBays},${i.devices},${i.category}`),t=[s,...e].join(`
`),d=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),x=URL.createObjectURL(d);r.setAttribute("href",x),r.setAttribute("download",`departments_${new Date().getTime()}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),m.success("Data exported successfully")},H=()=>{A.push({path:"/Departments_all_edit",query:{mode:"add"}})},J=s=>{const e=o.departments.findIndex(t=>t===s);console.log("Editing department:",s),console.log("Department index:",e),console.log("Department ID:",s.id),A.push({path:"/Departments_all_edit",query:{mode:"edit",index:e.toString(),id:s.id.toString()}})},K=s=>{re.confirm(`Are you sure you want to delete ${s.name}?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"confirm-delete-btn",cancelButtonClass:"cancel-delete-btn"}).then(async()=>{const e=o.departments.findIndex(t=>t.name===s.name&&t.locker===s.locker&&t.assignedBays===s.assignedBays);if(e!==-1)try{await o.deleteDepartment(e),m.success("Department deleted successfully")}catch(t){console.error("åˆ é™¤éƒ¨é—¨å¤±è´¥:",t),m.error("Failed to delete department: "+(t.message||"Unknown error"))}}).catch(()=>{console.log("Delete cancelled")})},$=async()=>{console.log("ðŸ”„ Departments initializing data...");try{await o.loadDepartments(),console.log("âœ… Departments data loaded successfully")}catch(s){console.error("âŒ Departments data loading failed:",s)}};return X(async()=>{console.log("ðŸ”„ Departments onMounted - component mounted"),await $()}),Y(async()=>{console.log("ðŸ”„ Departments onActivated - component activated from cache"),await $()}),(s,e)=>(y(),C("div",ie,[a("div",ue,[a("h1",pe,"Departments ("+p(n(o).departments.length)+")",1),a("div",me,[l(n(Z),{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"Search","prefix-icon":"el-icon-search",class:"search-input",onInput:q},null,8,["modelValue"]),l(n(h),{class:"import-btn",onClick:W},{default:c(()=>[...e[2]||(e[2]=[v("Import File",-1)])]),_:1}),a("input",{ref_key:"fileInput",ref:V,type:"file",accept:".csv,.xlsx,.xls",style:{display:"none"},onChange:O},null,544),l(n(h),{class:"export-btn",onClick:G},{default:c(()=>[...e[3]||(e[3]=[v("Export File",-1)])]),_:1}),l(n(h),{type:"primary",class:"add-dept-btn",onClick:H},{default:c(()=>[...e[4]||(e[4]=[v("Add New Department",-1)])]),_:1})])]),a("div",ge,[l(n(ee),{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),placeholder:"All Categories",clearable:"",style:{width:"200px"},onChange:z},{default:c(()=>[l(n(_),{label:"All Categories",value:""}),l(n(_),{label:"A1",value:"A1"}),l(n(_),{label:"A2",value:"A2"}),l(n(_),{label:"A3",value:"A3"}),l(n(_),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),a("div",fe,[(y(!0),C(te,null,se(T.value,(t,d)=>(y(),C("div",{key:d,class:"dept-card-wrapper"},[l(n(oe),{class:"dept-card"},{default:c(()=>[a("div",ye,[a("div",ve,[a("div",he,[e[5]||(e[5]=a("p",{class:"label"},"Department",-1)),a("p",_e,p(t.name),1)]),a("div",xe,[e[6]||(e[6]=a("p",{class:"label"},"Locker",-1)),a("p",be,p(t.locker),1)])]),a("div",we,[a("div",Ce,[e[7]||(e[7]=a("p",{class:"label"},"Assigned Bays",-1)),a("div",De,[a("div",ke,[a("p",{class:U(["value bays-value",{expanded:t.expanded}])},p(t.expanded?t.assignedBays:j(t.assignedBays)),3),S(t.assignedBays)?(y(),ae(n(ne),{key:0,class:U(["expand-icon",{expanded:t.expanded}]),onClick:r=>R(d)},{default:c(()=>[l(n(le))]),_:1},8,["class","onClick"])):N("",!0)]),t.expanded&&S(t.assignedBays)?(y(),C("div",Be,p(t.assignedBays),1)):N("",!0)])]),a("div",Ae,[e[8]||(e[8]=a("p",{class:"label"},"Bays Total",-1)),a("p",Ee,p(t.devices),1)])]),a("div",Ie,[l(n(h),{class:"edit-btn",onClick:r=>J(t,d)},{default:c(()=>[...e[9]||(e[9]=[v("Edit",-1)])]),_:1},8,["onClick"]),l(n(h),{class:"delete-btn",onClick:r=>K(t,d)},{default:c(()=>[...e[10]||(e[10]=[v("Delete",-1)])]),_:1},8,["onClick"])])])]),_:2},1024)]))),128))])]))}},Ne=P(Se,[["__scopeId","data-v-5a8999de"]]);export{Ne as default};

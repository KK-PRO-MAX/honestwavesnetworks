import{_ as M,J as O,r as g,o as q,c as J,z as L,a as k,b as x,d as n,e as c,w as u,u as h,K as R,i as U,g as _,F as $,l as j,t as B,m as s,I as Y}from"./index-COfldkwK.js";import{b as z,h as H,i as K,j as G}from"./locker-B9bkZgAW.js";import"./index-B9ygI19o.js";const Q={class:"locker-container"},W={class:"header-bar"},X={class:"action-buttons"},Z={class:"locker-grid"},ee={class:"card-content"},oe={class:"info-section"},te={class:"value-row"},ae={class:"department-value"},se={class:"devices-value"},le={class:"bays-value"},ne={class:"button-row"},re={class:"dialog-footer"},ie={__name:"Location",setup(de){const C=O(),v=g(!1),b=g(!1),y=g(-1),a=g({department:"",assignedBays:""}),A=()=>{C.back()},f=g(null),m=g(-1),p=g(null),r=g([]),I=async()=>{try{const e=localStorage.getItem("token");if(console.log("Token检查:",e?"存在":"不存在"),!e){s.warning("Please login first");return}console.log("=== 开始请求Location列表 ===");const o=await z();console.log("=== API响应成功 ==="),console.log("响应状态:",o.status),console.log("响应数据:",o.data);const t=o.data;if(t.ret===0&&(t.code===200||t.code==="200")){const l=t.ret_data||[];Array.isArray(l)?(r.value=l.map(i=>({id:i.id,department:i.location,devicesAssigned:String(i.locker_count||0),assignedBays:i.detail})),console.log("✓ Location data loaded successfully, total:",r.value.length,"records"),r.value.length>0?s.success(`Loading successful ${r.value.length} 条Location数据`):s.info("No Location data available")):(s.error("Data format error"),r.value=[])}else console.error("✗ API returned error:",t),s.error(t.msg||"Failed to load Location data"),r.value=[]}catch(e){console.error("=== Request failed ==="),console.error("Error object:",e),s.error("Failed to get Location list, please check network or token validity"),r.value=[]}};q(()=>{I()});const E=J(()=>r.value),D=e=>{!e||!e.id||Y.confirm("Are you sure you want to delete this locker? You will have 30 seconds to restore it.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"confirm-delete-btn",cancelButtonClass:"cancel-delete-btn"}).then(async()=>{try{const t=(await G({id:e.id})).data;if(t.ret===0&&(t.code===200||t.code==="200")){const l=r.value.findIndex(i=>i.id===e.id);if(l!==-1){f.value={...r.value[l]},m.value=l,r.value.splice(l,1);const i=s({type:"success",duration:3e4,showClose:!0,dangerouslyUseHTMLString:!0,message:`
              <div style="display: flex; align-items: center; justify-content: space-between; gap: 20px;">
                <span>Locker deleted successfully. You have 30 seconds to restore it.</span>
                <button 
                  id="restore-btn" 
                  style="
                    background-color: #0C306C; 
                    color: white; 
                    border: none; 
                    padding: 6px 16px; 
                    border-radius: 4px; 
                    cursor: pointer;
                    font-weight: 600;
                    white-space: nowrap;
                  "
                >
                  Restore
                </button>
              </div>
            `,onClose:()=>{f.value=null,m.value=-1,p.value&&(clearTimeout(p.value),p.value=null)}});setTimeout(()=>{const w=document.getElementById("restore-btn");w&&(w.onclick=()=>{S(),i.close()})},100),p.value=setTimeout(()=>{f.value=null,m.value=-1,p.value=null},3e4),console.log("✓ Location deleted successfully, ID:",e.id)}}else{console.error("✗ API delete failed:",t);const l=t.msg||"Failed to delete location";s.error(l)}}catch(o){console.error("Delete request exception:",o);const t=o.message||"Network error, please try again";s.error(t)}}).catch(()=>{s.info("Delete cancelled")})},S=()=>{f.value&&m.value!==-1&&(r.value.splice(m.value,0,f.value),s.success("Locker restored successfully"),f.value=null,m.value=-1,p.value&&(clearTimeout(p.value),p.value=null))},N=()=>{b.value=!1,y.value=-1,a.value={department:"",assignedBays:""},v.value=!0},V=e=>{b.value=!0,y.value=e.id,console.log("Open edit dialog"),console.log("Original data:",JSON.stringify(e)),a.value={department:e.department,assignedBays:e.assignedBays},console.log("Data converted:",JSON.stringify(a.value)),v.value=!0},F=async()=>{if(!a.value.department.trim()){s.warning("Please enter location name");return}if(!a.value.assignedBays.trim()){s.warning("Please enter detailed address");return}if(b.value)try{if(console.log("Start editing Location"),console.log("editIndex.value before editing:",y.value),console.log("Edit form data:",JSON.stringify(a.value)),!a.value.department.trim()){s.error("Location name is required"),console.error("Edit validation failed: department is empty");return}if(!a.value.assignedBays.trim()){s.error("Detail is required"),console.error("Edit validation failed: assignedBays is empty");return}const e={id:y.value,location:a.value.department.trim(),detail:a.value.assignedBays.trim()};console.log("Verify edit parameters:",JSON.stringify(e)),console.log("id:",e.id,"type:",typeof e.id),console.log("location:",e.location,"type:",typeof e.location),console.log("detail:",e.detail,"type:",typeof e.detail);const t=(await H(e)).data;if(console.log("✓ API response successful"),console.log("Response data:",JSON.stringify(t)),t.ret===0&&(t.code===200||t.code==="200")){const l=r.value.findIndex(i=>i.id===y.value);console.log("Found local index:",l),l!==-1?(r.value[l]={...r.value[l],department:a.value.department.trim(),assignedBays:a.value.assignedBays.trim()},s.success("Location updated successfully"),console.log("✓ Location updated successfully")):(console.error("Could not find Location to edit"),s.error("Failed to update location"))}else{console.error("API edit failed:",t);const l=t.msg||"Failed to update location";s.error(l)}}catch(e){console.error("Edit request error:",e);const o=e.message||"Failed to update location, please check network or parameters";s.error(o)}else try{if(console.log("Start adding Location"),console.log("Add form complete data:",JSON.stringify(a.value)),!a.value.department.trim()){s.error("Location name is required"),console.error("Add validation failed: location is empty");return}if(!a.value.assignedBays.trim()){s.error("Detail is required"),console.error("Add validation failed: detail is empty");return}const e={location:parseInt(a.value.department)||a.value.department.charCodeAt(0),detail:a.value.assignedBays.trim()};console.log("Verify add parameters:",JSON.stringify(e)),console.log("location content:",e.location,"type:",typeof e.location),console.log("detail content:",e.detail,"type:",typeof e.detail);const t=(await K(e)).data;if(console.log("✓ Add successful, returned ID:",t.ret_data),t.ret===0&&(t.code===200||t.code==="200")){const l={id:t.ret_data,department:a.value.department.trim(),devicesAssigned:"0",assignedBays:a.value.assignedBays.trim()};r.value.push(l),s.success("Location added successfully"),console.log("✓ New Location added to list:",l)}else console.error("Add failed:",t),s.error(t.msg||"Failed to add location")}catch(e){console.error("Add request error:",e),s.error("Failed to add location, please check network or parameters")}v.value=!1};return(e,o)=>{const t=L("el-button"),l=L("el-input"),i=L("el-form-item"),w=L("el-form"),P=L("el-dialog");return x(),k("div",Q,[n("div",W,[c(h(U),{class:"back-arrow",onClick:A},{default:u(()=>[c(h(R))]),_:1}),o[5]||(o[5]=n("h2",null,"Location",-1)),n("div",X,[c(t,{type:"",style:{"background-color":"#0C306C",color:"#fff","font-weight":"600"},onClick:N},{default:u(()=>[...o[4]||(o[4]=[_(" Add Location ",-1)])]),_:1})])]),n("div",Z,[(x(!0),k($,null,j(E.value,d=>(x(),k("div",{key:d.id,class:"locker-card"},[n("div",ee,[n("div",oe,[o[8]||(o[8]=n("div",{class:"label-row"},[n("span",{class:"label"},"Location"),n("span",{class:"label label-right"},"Locker Num")],-1)),n("div",te,[n("span",ae,B(d.department),1),n("span",se,B(d.devicesAssigned),1)]),o[9]||(o[9]=n("p",null,[n("span",{class:"label"},"Detail")],-1)),n("p",le,B(d.assignedBays),1),n("div",ne,[c(t,{type:"",class:"action-btn edit-btn",onClick:T=>V(d)},{default:u(()=>[...o[6]||(o[6]=[_(" Edit ",-1)])]),_:1},8,["onClick"]),c(t,{class:"action-btn delete-btn",onClick:T=>D(d)},{default:u(()=>[...o[7]||(o[7]=[_(" Delete ",-1)])]),_:1},8,["onClick"])])])])]))),128))]),c(P,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=d=>v.value=d),title:b.value?"Edit Location":"Add Location",width:"565px",style:{"--you-dialog-width":"565px","font-weight":"700",color:"#000",gap:"28px","border-radius":"24px","padding-top":"52px","padding-right":"24px","padding-bottom":"52px","padding-left":"24px"},"custom-class":"custom-dialog","close-on-click-modal":!1},{footer:u(()=>[n("span",re,[c(t,{type:"default",class:"cancel-btn",onClick:o[2]||(o[2]=d=>v.value=!1)},{default:u(()=>[...o[10]||(o[10]=[_("Cancel",-1)])]),_:1}),c(t,{type:"primary",class:"save-btn",onClick:F},{default:u(()=>[...o[11]||(o[11]=[_("Save",-1)])]),_:1})])]),default:u(()=>[c(w,{model:a.value,"label-position":"top",class:"location-form"},{default:u(()=>[c(i,{label:"Location*"},{default:u(()=>[c(l,{modelValue:a.value.department,"onUpdate:modelValue":o[0]||(o[0]=d=>a.value.department=d),placeholder:"Enter location (e.g., California, New York)"},null,8,["modelValue"])]),_:1}),c(i,{label:"Detail*"},{default:u(()=>[c(l,{modelValue:a.value.assignedBays,"onUpdate:modelValue":o[1]||(o[1]=d=>a.value.assignedBays=d),placeholder:"Enter detailed address (e.g., 123 Main St, City, State 12345)",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ge=M(ie,[["__scopeId","data-v-89b14370"]]);export{ge as default};

import{_ as le,J as se,r as v,c as L,o as oe,v as re,x as W,a8 as de,a as w,b as y,d as l,$ as ne,t as p,e as d,u as r,j as ce,w as u,g as m,h as f,E as k,f as ie,G as ue,O as g,n as H,P as ve,F as pe,l as me,Q as N,m as i,I as fe}from"./index-COfldkwK.js";import{u as ge}from"./userStore-Dd1FBqDa.js";import{u as ye}from"./filterStore-wW98jmOu.js";import{g as be,d as _e}from"./user-DZDS1ZP8.js";import{g as he}from"./locker-B9bkZgAW.js";import"./index-B9ygI19o.js";const we={class:"users-page"},ke={class:"header-row"},Ce={class:"page-title"},Se={class:"header-actions"},Ie={class:"filter-section"},Ae={class:"name-with-status"},Ee={class:"operation-buttons"},Ue={class:"user-cards mobile-cards"},De={class:"card-row data-row"},xe={class:"card-cell"},Le={class:"cell-value name-with-status"},Ne={class:"card-cell"},Ve={class:"cell-value"},Be={class:"card-row data-row"},Fe={class:"card-cell"},$e={class:"cell-value"},Oe={class:"card-cell"},Te={class:"cell-value"},Re={class:"card-row data-row"},je={class:"card-cell"},Pe={class:"cell-value"},Me={class:"card-cell"},ze={class:"cell-value"},qe={class:"card-row data-row"},Je={class:"card-cell action-cell",style:{"grid-column":"1 / -1"}},We={class:"cell-value"},He={class:"action-buttons"},Qe=Object.assign({name:"Users"},{__name:"Users",setup(Ge){const E=se(),V=ge(),B=ye(),U=v([]),b=v([]),C=v(!1),F=v(0),$=v(1),D=v(10),O=v(0),S=v(""),I=L({get:()=>B.selectedCategory,set:t=>B.setCategory(t)}),Q={backgroundColor:"#0C306C",color:"#fff",fontWeight:"bold"},_=L(()=>{let t=[...U.value];if(I.value&&(t=t.filter(e=>e.category===I.value)),S.value){const e=S.value.toLowerCase();t=t.filter(s=>Object.entries(s).some(([a,o])=>a!=="category"&&o&&o.toString().toLowerCase().includes(e)))}return t}),G=L(()=>{const t=($.value-1)*D.value,e=t+D.value;return _.value.slice(t,e)}),T={0:"Temporary",1:"Full Time",2:"Manager",3:"Admin",4:"Factory Admin",5:"Super Admin",6:"Supervisor"},R={0:"Inactive",1:"Active",2:"Pending"},x=async()=>{try{console.log("å¼€å§‹è¯·æ±‚Lockeråˆ—è¡¨...");const t=await he();t.data.ret===0&&(t.data.code===200||t.data.code==="200")?(b.value=t.data.ret_data||[],console.log("âœ“ Lockeråˆ—è¡¨åŠ è½½æˆåŠŸï¼Œå…±",b.value.length,"æ¡")):(console.error("âœ— Lockeråˆ—è¡¨APIè¿”å›žé”™è¯¯:",t.data),b.value=[])}catch(t){console.error("èŽ·å–Lockeråˆ—è¡¨å¤±è´¥:",t),b.value=[]}},A=async()=>{C.value=!0;try{console.log("å¼€å§‹è¯·æ±‚ç”¨æˆ·æ•°æ®æŽ¥å£...");const t=await be();if(console.log("æŽ¥å£è¿”å›žå®Œæ•´æ•°æ®:",t.data),t.data.ret===0&&(t.data.code===200||t.data.code==="200")){const e=t.data.ret_data;let s=e;if(typeof e=="string")try{s=JSON.parse(e)}catch(a){console.error("è§£æžç”¨æˆ·æ•°æ®å¤±è´¥:",a),i.error("Failed to parse user data"),C.value=!1;return}console.log("æŽ¥å£è¿”å›žç”¨æˆ·åˆ—è¡¨:",s),U.value=s.map(a=>{const o=b.value.find(c=>c===a.locker),n=(o==null?void 0:o.name)||(a.locker!==void 0?` ${a.locker}`:"");return{id:a.id,name:a.name||`${a.user_first_name||a["user first name"]||""} ${a.user_last_name||a["user last name"]||""}`.trim()||"Unknown",employeeId:a.employee_id!==void 0||a.employee_id!==void 0?a.employee_id.toString():"",badgeId:a.user_badge_id!==void 0?a.user_badge_id.toString():a["user badge_id"]!==void 0?a["user badge_id"].toString():"",locker:n,locker_id:a.locker_id,role:T[a.role_id]||T[a.role_id]||`Role ${a.role_id||a.role_id||""}`,status:R[a.status]||R[a.status]||`Status ${a.status||a.status||""}`,category:"",employmentStatus:a.status===1||a.status===1?"active":"inactive",originalData:a}}),console.log("è½¬æ¢åŽçš„æ•°æ®:",U.value),F.value++}else console.error("æŽ¥å£è¿”å›žé”™è¯¯çŠ¶æ€:",t.data),i.error(t.data.msg||"Failed to fetch data")}catch(t){console.error("æŽ¥å£è¯·æ±‚å¤±è´¥:",t),i.error(`Request failed: ${t.message||"Network error"}`)}finally{C.value=!1}},j=v(null),K=()=>{j.value.click()},X=t=>{const e=t.target.files[0];if(!e)return;const s=new FileReader;e.name.endsWith(".csv")?(s.onload=a=>{const o=a.target.result,n=Y(o);n&&(V.userList=n,t.target.value="")},s.readAsText(e)):e.name.endsWith(".json")?(s.onload=a=>{try{const o=JSON.parse(a.target.result);Array.isArray(o)?(V.userList=o,t.target.value=""):i.error("Invalid JSON format. Expected an array.")}catch(o){i.error("Error parsing JSON file: "+o.message)}},s.readAsText(e)):i.error("Unsupported file format. Please upload CSV or JSON.")},Y=t=>{try{const e=t.split(`
`).filter(c=>c.trim());if(e.length<2)return i.error("CSV file is empty or has no data."),null;const s=e[0].split(",").map(c=>c.trim()),a=["name","employeeId","badgeId","locker","role","status"],o=a.filter(c=>!s.some(h=>h.toLowerCase()===c));if(o.length>0)return i.error(`CSV file is missing required columns: ${o.join(", ")}`),null;const n=[];for(let c=1;c<e.length;c++){const h=e[c].split(","),z={};s.forEach((ae,te)=>{var J;const q=ae.toLowerCase();a.includes(q)&&(z[q]=((J=h[te])==null?void 0:J.trim())||"")}),n.push(z)}return n}catch(e){return i.error("Error parsing CSV file: "+e.message),null}},Z=()=>{const t=_.value,e=["name","employeeId","badgeId","locker","role","status"],s=[e.join(","),...t.map(c=>e.map(h=>c[h]||"").join(","))].join(`
`),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),n=document.createElement("a");n.href=o,n.download="users_export.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n)},ee=()=>{E.push({name:"Users_all_edit",query:{mode:"add"}})},P=t=>{E.push({path:"/Users_all_edit",query:{mode:"edit",id:t.id,name:t.name,employeeId:t.employeeId,badgeId:t.badgeId,locker:t.locker,role:t.role,status:t.status,category:t.category||"",employmentStatus:t.employmentStatus||"active"}})},M=async t=>{var e;try{if(await fe.confirm(`Are you sure you want to delete user ${t.name}? This action cannot be undone.`,"Confirm Deletion",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"})==="confirm"){const a=await _e({id:t.id});if(a.data&&(a.data.ret===0||a.data.code===200||a.data.code==="200"))i.success("User deleted successfully"),A();else throw new Error(((e=a.data)==null?void 0:e.msg)||"Failed to delete user")}}catch(s){s==="cancel"?i.info("Deletion cancelled"):(console.error("åˆ é™¤ç”¨æˆ·å‡ºé”™:",s),i.error(s.message||"Failed to delete user"))}};return oe(async()=>{await x(),await A()}),re(async()=>{await x(),await A()}),W(()=>_.value,t=>{O.value=t.length,console.log("ðŸ“Š Pagination Data Update:",{"Total Items":O.value,"Current Page":$.value,"Page Size":D.value,"Current Page Items":t.length})},{immediate:!0}),W(()=>E.currentRoute.value,async(t,e)=>{e.path&&e.path.includes("Users_all_edit")&&t.name==="Users"&&(await x(),await A())}),(t,e)=>{const s=de("loading");return y(),w("div",we,[l("div",ke,[l("h1",Ce,"Users ("+p(_.value.length)+")",1),l("div",Se,[d(r(ce),{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=a=>S.value=a),placeholder:"Search",style:{width:"200px"},clearable:""},null,8,["modelValue"]),d(r(f),{class:"import-btn",onClick:K},{default:u(()=>[...e[2]||(e[2]=[m(" Import File ",-1)])]),_:1}),d(r(f),{class:"export-btn",onClick:Z},{default:u(()=>[...e[3]||(e[3]=[m(" Export File ",-1)])]),_:1}),d(r(f),{type:"primary",class:"add-user-btn",onClick:ee},{default:u(()=>[...e[4]||(e[4]=[m("Add New User",-1)])]),_:1}),l("input",{ref_key:"fileInput",ref:j,type:"file",style:{display:"none"},accept:".csv,.json",onChange:X},null,544)])]),l("div",Ie,[d(r(ie),{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=a=>I.value=a),placeholder:"All Categories",clearable:"",style:{width:"200px"}},{default:u(()=>[d(r(k),{label:"All Categories",value:""}),d(r(k),{label:"A1",value:"A1"}),d(r(k),{label:"A2",value:"A2"}),d(r(k),{label:"A3",value:"A3"}),d(r(k),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),ne((y(),ue(r(ve),{key:F.value,data:_.value,"header-cell-style":Q,class:"users-table desktop-table"},{default:u(()=>[d(r(g),{prop:"name",label:"Name"},{default:u(a=>[l("div",Ae,[(y(),w("svg",{class:H(["status-icon",a.row.employmentStatus==="active"?"status-active":"status-inactive"]),viewBox:"0 0 24 24",fill:"currentColor"},[...e[5]||(e[5]=[l("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])],2)),l("span",null,p(a.row.name),1)])]),_:1}),d(r(g),{prop:"employeeId",label:"Employee ID"}),d(r(g),{prop:"badgeId",label:"Badge ID"}),d(r(g),{prop:"locker",label:"Locker"}),d(r(g),{prop:"role",label:"Role"}),d(r(g),{prop:"status",label:"Status"}),d(r(g),{label:"Operation",align:"center",width:"200"},{default:u(a=>[l("div",Ee,[d(r(f),{type:"primary",plain:"",class:"edit-btn",onClick:o=>P(a.row)},{default:u(()=>[...e[6]||(e[6]=[m(" Edit ",-1)])]),_:1},8,["onClick"]),d(r(f),{type:"danger",plain:"",class:"delete-btn",onClick:o=>M(a.row)},{default:u(()=>[...e[7]||(e[7]=[m(" Delete ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[s,C.value]]),l("div",Ue,[(y(!0),w(pe,null,me(G.value,(a,o)=>(y(),w("div",{key:o,class:"user-card"},[e[14]||(e[14]=N('<div class="card-row header-row-card" data-v-62c9409b><div class="card-cell" data-v-62c9409b><div class="cell-label" data-v-62c9409b>Name</div></div><div class="card-divider-vertical" data-v-62c9409b></div><div class="card-cell" data-v-62c9409b><div class="cell-label" data-v-62c9409b>Employee ID</div></div></div>',1)),l("div",De,[l("div",xe,[l("div",Le,[(y(),w("svg",{class:H(["status-icon",a.employmentStatus==="active"?"status-active":"status-inactive"]),viewBox:"0 0 24 24",fill:"currentColor"},[...e[8]||(e[8]=[l("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])],2)),l("span",null,p(a.name),1)])]),e[9]||(e[9]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",Ne,[l("div",Ve,p(a.employeeId),1)])]),e[15]||(e[15]=N('<div class="card-row header-row-card" data-v-62c9409b><div class="card-cell" data-v-62c9409b><div class="cell-label" data-v-62c9409b>Badge ID</div></div><div class="card-divider-vertical" data-v-62c9409b></div><div class="card-cell" data-v-62c9409b><div class="cell-label" data-v-62c9409b>Locker</div></div></div>',1)),l("div",Be,[l("div",Fe,[l("div",$e,p(a.badgeId),1)]),e[10]||(e[10]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",Oe,[l("div",Te,p(a.locker),1)])]),e[16]||(e[16]=N('<div class="card-row header-row-card" data-v-62c9409b><div class="card-cell" data-v-62c9409b><div class="cell-label" data-v-62c9409b>Role</div></div><div class="card-divider-vertical" data-v-62c9409b></div><div class="card-cell" data-v-62c9409b><div class="cell-label" data-v-62c9409b>Status</div></div></div>',1)),l("div",Re,[l("div",je,[l("div",Pe,p(a.role),1)]),e[11]||(e[11]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",Me,[l("div",ze,p(a.status),1)])]),e[17]||(e[17]=l("div",{class:"card-row header-row-card"},[l("div",{class:"card-cell",style:{"grid-column":"1 / -1"}},[l("div",{class:"cell-label"},"Operation")])],-1)),l("div",qe,[l("div",Je,[l("div",We,[l("div",He,[d(r(f),{type:"primary",plain:"",class:"edit-btn-mobile",onClick:n=>P(a)},{default:u(()=>[...e[12]||(e[12]=[m(" Edit ",-1)])]),_:1},8,["onClick"]),d(r(f),{type:"danger",plain:"",class:"delete-btn-mobile",onClick:n=>M(a)},{default:u(()=>[...e[13]||(e[13]=[m(" Delete ",-1)])]),_:1},8,["onClick"])])])])])]))),128))])])}}}),ta=le(Qe,[["__scopeId","data-v-62c9409b"]]);export{ta as default};

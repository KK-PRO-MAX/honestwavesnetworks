import{Y as v,r as l,m as n}from"./index-COfldkwK.js";import{g as u,a as f,e as w,d as p}from"./device-p3qppuv_.js";const E=v("device",()=>{const i=l([]),c=l(!1),t=l(null),s=async(a={})=>{c.value=!0,t.value=null;try{console.log("开始加载设备列表...",a);const r=await u(a);if(console.log("API 响应:",r),r&&r.data){const e=r.data;if(console.log("响应数据结构:",e),e.ret===0||e.code===200||e.code==="200"){let o=e.ret_data;if(typeof o=="string")try{o=JSON.parse(o)}catch(_){throw console.error("解析设备数据失败:",_),new Error("数据格式错误")}return o&&Array.isArray(o)?(i.value=o,console.log("✓ 设备列表加载成功，共",i.value.length,"条记录"),o):(console.warn("⚠ API 返回格式异常，使用本地演示数据"),i.value=d(),i.value)}else throw new Error(e.msg||`API 错误：${e.code}`)}else throw new Error("无效的 API 响应")}catch(r){const e=r instanceof Error?r.message:"获取设备列表失败";return t.value=e,console.error("✗ 设备列表加载失败:",e,r),console.log("✓ 使用本地演示数据"),i.value=d(),r instanceof Error&&(r.message.includes("Network")||r.message.includes("timeout"))&&n.warning("网络连接失败，显示本地数据"),i.value}finally{c.value=!1}},d=()=>[{id:1,device_id:"001",device_name:"iPhone 15",device_type_id:1,device_type:"iPhone",device_nfc_code:12345,cabinet_no:1,locker_id:1},{id:2,device_id:"002",device_name:"iPad Pro",device_type_id:2,device_type:"iPad",device_nfc_code:12346,cabinet_no:2,locker_id:1},{id:3,device_id:"003",device_name:"MacBook Pro",device_type_id:3,device_type:"Laptop",device_nfc_code:12347,cabinet_no:3,locker_id:2}];return{deviceList:i,loading:c,error:t,loadDeviceList:s,getLocalDemoData:d,addDevice:async a=>{var r;c.value=!0,t.value=null;try{const e={device_id:a.device_id,device_name:a.device_name,device_type_id:a.device_type_id,device_nfc_code:a.device_nfc_code,cabinet_no:a.cabinet_no,locker_id:a.locker_id},o=await f(e);if(o.data&&o.data.ret===0)return n.success("设备添加成功"),await s(),o.data.ret_data;throw new Error(((r=o.data)==null?void 0:r.msg)||"添加设备失败")}catch(e){throw t.value=e instanceof Error?e.message:"添加设备失败",n.error(t.value),console.error("添加设备出错:",e),e}finally{c.value=!1}},updateDevice:async a=>{var r;c.value=!0,t.value=null;try{if(!a.id)throw new Error("设备ID不存在");const e={id:a.id,device_id:a.device_id,device_name:a.device_name,device_type_id:a.device_type_id,device_nfc_code:a.device_nfc_code,cabinet_no:a.cabinet_no,locker_id:a.locker_id},o=await w(e);if(o.data&&o.data.ret===0)return n.success("设备更新成功"),await s(),o.data.ret_data;throw new Error(((r=o.data)==null?void 0:r.msg)||"更新设备失败")}catch(e){throw t.value=e instanceof Error?e.message:"更新设备失败",n.error(t.value),console.error("更新设备出错:",e),e}finally{c.value=!1}},deleteDevice:async a=>{var r;c.value=!0,t.value=null;try{const e=await p({id:a});if(e.data&&e.data.ret===0)return n.success("设备删除成功"),await s(),e.data.ret_data;throw new Error(((r=e.data)==null?void 0:r.msg)||"删除设备失败")}catch(e){throw t.value=e instanceof Error?e.message:"删除设备失败",n.error(t.value),console.error("删除设备出错:",e),e}finally{c.value=!1}}}});export{E as u};

import{_ as R,J as T,r as B,c as y,o as P,z as m,a8 as O,a as l,b as r,d as c,$ as K,G as D,e as i,w as L,F as z,l as J,H as I,y as p,t as C,m as M}from"./index-COfldkwK.js";import{u as q}from"./filterStore-wW98jmOu.js";import{p as Y}from"./locker-B9bkZgAW.js";import"./index-B9ygI19o.js";const j={class:"bay-management"},Q={class:"filter-section"},W={key:0,class:"loading-container",style:{"min-height":"200px"}},X=["onClick"],Z={class:"bay-number"},ee={key:0,class:"bay-time"},te={key:0},ae={key:1},oe={class:"bay-status"},se={__name:"Bay_Management",setup(re){const k=T(),N=q(),u=B(!1),A=y({get:()=>N.selectedCategory,set:a=>N.setCategory(a)}),d=B([]),G=B([]),F=(a,e)=>e?e.toUpperCase():{0:"UNAVAILABLE",1:"AVAILABLE",2:"CHARGING",3:"CLEANING",4:"OCCUPIED",5:"DAMAGED",6:"LATE CHECK-IN"}[a]||"UNAVAILABLE",w=async(a=1)=>{u.value=!0;try{console.log("开始获取Bay数据, locker_id:",a);const e=await Y({locker_id:a});if(console.log("Bay API响应:",e.data),e.data.ret!==0||e.data.code!==200&&e.data.code!=="200")throw new Error(e.data.msg||"Failed to fetch bay list");let o=[];if(typeof e.data.ret_data=="string")try{o=JSON.parse(e.data.ret_data)}catch(s){console.error("解析 ret_data 失败:",s),o=[]}else o=e.data.ret_data||[];console.log("解析后的Bay数据:",o),G.value=o,d.value=o.map(s=>{const _=t=>{if(!t||t===0)return"";const n=new Date(t*1e3),E=n.getHours(),v=n.getMinutes();return`${E}:${v.toString().padStart(2,"0")}`},g=t=>{if(!t||t===0)return"";const n=new Date(t*1e3),E=n.getMonth()+1,v=n.getDate(),x=n.getFullYear().toString().slice(-2);return`${E}/${v}/${x}`},f=s.check_out_time||s.check_in_time||0;return{id:parseInt(s.cabinet_no)||s.id,status:F(s.cabinet_state,s.cabinet_name),time:_(f),date:g(f),category:"A1",deviceType:"iPhone",deactivatedReason:s.cabinet_deactivated_reason||"",rawData:s}}),console.log("映射后的bays:",d.value),M.success("Bay data loaded successfully")}catch(e){console.error("获取Bay列表失败:",e),M.error("Failed to load bay data: "+(e.message||"Unknown error")),d.value=[]}finally{u.value=!1}};P(()=>{w()});const V=y(()=>{let a=d.value;return A.value&&(a=a.filter(e=>e.category===A.value)),a}),U=a=>{if(!a)return"";const[e,o]=a.split(":").map(Number),s=e>=12?"pm":"am";return`${e%12||12}:${o.toString().padStart(2,"0")}${s}`},H=a=>{const e=d.value.find(s=>s.id===a),o=(e==null?void 0:e.rawData)||{};k.push({path:"/Bay_Recent_Activities",query:{bayNumber:a,lockerId:o.locker_id||1,cabinetNo:o.cabinet_no||a,cabinetState:o.cabinet_state||0,cabinetName:o.cabinet_name||"",deactivatedReason:o.cabinet_deactivated_reason||""}})},S=a=>({AVAILABLE:"#f0f9f0",CHARGING:"#f0f9f0",CLEANING:"#f0f7fc",OCCUPIED:"#fff8e6",UNAVAILABLE:"#EFEFEF","LATE CHECK-IN":"#fff8e6",DAMAGED:"#feeaea"})[a]||"#ffffff",b=a=>({AVAILABLE:"#1BAA00",CHARGING:"#1BAA00",CLEANING:"#002F6C",OCCUPIED:"#B07800",UNAVAILABLE:"#686868","LATE CHECK-IN":"#B07800",DAMAGED:"#970300"})[a]||"#686868",h=a=>({AVAILABLE:"#1BAA00",CHARGING:"#1BAA00",CLEANING:"#002F6C",OCCUPIED:"#B07800",UNAVAILABLE:"#686868","LATE CHECK-IN":"#B07800",DAMAGED:"#970300"})[a]||"#686868",$=a=>({AVAILABLE:"#22D500",CHARGING:"#22D500",CLEANING:"#1BAAE3",OCCUPIED:"#FFAE00",UNAVAILABLE:"#AFAFAF","LATE CHECK-IN":"#FFAE00",DAMAGED:"#FF0400"})[a]||"#686868";return(a,e)=>{const o=m("el-option"),s=m("el-select"),_=m("el-col"),g=m("el-row"),f=O("loading");return r(),l("div",j,[e[1]||(e[1]=c("div",{class:"header-row"},[c("h1",{class:"page-title"},"Bay Management")],-1)),c("div",Q,[i(s,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=t=>A.value=t),placeholder:"All Categories",clearable:"",style:{width:"200px"}},{default:L(()=>[i(o,{label:"All Categories",value:""}),i(o,{label:"A1",value:"A1"}),i(o,{label:"A2",value:"A2"}),i(o,{label:"A3",value:"A3"}),i(o,{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),u.value?K((r(),l("div",W,null,512)),[[f,u.value]]):(r(),D(g,{key:1,gutter:20,class:"bays-container"},{default:L(()=>[(r(!0),l(z,null,J(V.value,t=>(r(),D(_,{key:t.id,xs:12,sm:8,md:6,lg:4,xl:3,class:"bay-col"},{default:L(()=>[c("div",{class:"bay-card",style:I({backgroundColor:S(t.status),border:`1px solid ${b(t.status)}`,color:h(t.status)}),onClick:n=>H(t.id)},[c("div",{class:"status-indicator",style:I({backgroundColor:$(t.status)})},null,4),c("div",Z,C(t.id),1),t.time||t.date?(r(),l("div",ee,[t.time?(r(),l("span",te,C(U(t.time)),1)):p("",!0),t.time&&t.date?(r(),l("br",ae)):p("",!0),t.date?(r(),l("span",{key:2,class:"date-format",style:I({color:h(t.status)})},C(t.date),5)):p("",!0)])):p("",!0),c("div",oe,C(t.status),1)],12,X)]),_:2},1024))),128))]),_:1}))])}}},de=R(se,[["__scopeId","data-v-fd19f59f"]]);export{de as default};

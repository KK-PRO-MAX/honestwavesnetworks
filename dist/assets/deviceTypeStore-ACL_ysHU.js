import{Y as u,r as n,m as l}from"./index-COfldkwK.js";import{a as v}from"./index-B9ygI19o.js";const i=v.create({baseURL:"https://guiz.haomengwl.com/api",timeout:1e4,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{var r;const s=localStorage.getItem("token");return s&&(e.headers.token=s),console.log("Device Type API 发送请求:",(r=e.method)==null?void 0:r.toUpperCase(),e.url),console.log("请求数据:",e.data),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e)));i.interceptors.response.use(e=>(console.log("Device Type API 收到响应:",e.status,e.data),e.data&&typeof e.data=="object"&&(e.data.ret!==void 0&&console.log("  ✓ ret:",e.data.ret),e.data.code!==void 0&&console.log("  ✓ code:",e.data.code),e.data.msg!==void 0&&console.log("  ✓ msg:",e.data.msg),e.data.ret_data!==void 0&&(console.log("  ✓ ret_data 类型:",Array.isArray(e.data.ret_data)?"Array":typeof e.data.ret_data),Array.isArray(e.data.ret_data)&&console.log("    数据数量:",e.data.ret_data.length))),e),e=>(console.error("Device Type API 响应错误:",e.message||e),e.response?(console.error("  HTTP 状态码:",e.response.status),console.error("  响应数据:",e.response.data)):e.request?console.error("  没有接收到响应"):console.error("  请求错误:",e.message),Promise.reject(e)));function y(){return i.post("/Devices/device_type_list",{})}function p(e){return i.post("/Devices/add_device_type",e)}function f(e){return i.post("/Devices/edit_device_type",e)}function g(e){return!e||typeof e.id!="number"||e.id<=0?Promise.reject(new Error("Invalid device type id")):i.post("/Devices/del_device",e)}const T=u("deviceType",()=>{const e=n([]),s=n(!1),r=n(null),d=async()=>{var o;s.value=!0,r.value=null;try{console.log("开始加载设备类型列表...");const a=await y();if(console.log("API 响应:",a),a.data&&a.data.ret===0){const t=Array.isArray(a.data.ret_data)?a.data.ret_data:[];e.value=t,console.log(`✓ 设备类型列表加载成功，共 ${e.value?e.value.length:0} 条记录`)}else throw new Error(((o=a.data)==null?void 0:o.msg)||"获取设备类型列表失败")}catch(a){r.value=a instanceof Error?a.message:"获取设备类型列表失败",console.error("获取设备类型列表出错:",a),e.value=[]}finally{s.value=!1}};return{deviceTypeList:e,loading:s,error:r,loadDeviceTypeList:d,addDeviceType:async o=>{var a;s.value=!0,r.value=null;try{const t={device_type:o.device_type,device_category:o.device_category,devices_count:0},c=await p(t);if(c.data&&c.data.ret===0)return l.success("设备类型添加成功"),await d(),c.data.ret_data;throw new Error(((a=c.data)==null?void 0:a.msg)||"添加设备类型失败")}catch(t){throw r.value=t instanceof Error?t.message:"添加设备类型失败",l.error(r.value),console.error("添加设备类型出错:",t),t}finally{s.value=!1}},updateDeviceType:async o=>{var a;s.value=!0,r.value=null;try{if(!o.id)throw new Error("设备类型ID不存在");const t={id:o.id,device_type:o.device_type,device_category:o.device_category,devices_count:o.devices_count},c=await f(t);if(c.data&&c.data.ret===0)return l.success("设备类型更新成功"),await d(),c.data.ret_data;throw new Error(((a=c.data)==null?void 0:a.msg)||"更新设备类型失败")}catch(t){throw r.value=t instanceof Error?t.message:"更新设备类型失败",l.error(r.value),console.error("更新设备类型出错:",t),t}finally{s.value=!1}},deleteDeviceType:async o=>{var a;s.value=!0,r.value=null;try{const t=await g({id:o});if(t.data&&t.data.ret===0)return l.success("设备类型删除成功"),await d(),t.data.ret_data;throw new Error(((a=t.data)==null?void 0:a.msg)||"删除设备类型失败")}catch(t){throw r.value=t instanceof Error?t.message:"删除设备类型失败",l.error(r.value),console.error("删除设备类型出错:",t),t}finally{s.value=!1}}}});export{T as u};

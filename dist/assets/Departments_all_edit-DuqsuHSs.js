import{_ as se,D as ae,J as oe,r,c as ne,o as de,m as b,z as w,a as D,b as v,d as a,e as d,w as n,u as re,K as ie,t as V,F as $,l as N,G as M,g as c,y as ue,n as T}from"./index-COfldkwK.js";import{u as ce}from"./departmentStore-CZLnaYq0.js";import"./index-B9ygI19o.js";const me={class:"edit-page"},pe={class:"page-header"},ve={class:"page-title"},fe={class:"form-section"},ge={class:"form-section"},ye={class:"form-section"},_e={class:"section-with-button"},ke={class:"tags-container"},be={class:"section-with-button"},De={class:"tags-container"},Be={class:"footer-buttons"},Ce={class:"card-grid"},Ue=["onClick"],xe={class:"dialog-footer"},Se={class:"card-grid"},we=["onClick"],Ve={class:"dialog-footer"},Ie={__name:"Departments_all_edit",setup(Ae){const I=ae(),A=oe(),m=ce(),E=r(""),f=r(!1),p=r(-1),h=ne(()=>f.value?"Edit Department":"Add New Department"),g=r(""),B=r(""),C=r(""),U=r(!1),x=r(!1),y=r([]),_=r([]),S=r(!1),u=r([]),k=r([]),j=r([{id:"u1",name:"User 1"},{id:"u2",name:"User 2"},{id:"u3",name:"User 3"},{id:"u4",name:"User 4"},{id:"u5",name:"User 5"}]),z=r(Array.from({length:100},(o,e)=>({id:`bay${e+1}`,name:`Bay ${e+1}`})));de(async()=>{const o=I.query.mode;if(f.value=o==="edit",console.log("Route query:",I.query),console.log("Edit mode:",f.value),f.value){p.value=parseInt(I.query.index);const e=parseInt(I.query.id);console.log("Department Index:",p.value),console.log("Department ID:",e),m.departments.length===0&&(console.log("⚠ Store 为空，加载部门数据..."),await m.loadDepartments());let l=null;if(e&&(l=m.departments.find(s=>s.id===e),console.log("通过ID查找的部门数据:",l)),!l&&p.value>=0&&p.value<m.departments.length&&(l=m.departments[p.value],console.log("通过索引查找的部门数据:",l)),l){if(console.log("✅ 找到部门数据:",l),g.value=l.name||"",B.value=l.locker||"",C.value=l.detail||"",E.value=l.devices||"",console.log("加载的字段值:"),console.log("  - name:",g.value),console.log("  - locker:",B.value),console.log("  - detail:",C.value),console.log("  - assignedBays:",l.assignedBays),console.log("  - devices:",l.devices),console.log("  - user_list:",l.user_list),l.assignedBays){const s=l.assignedBays.split(",").map(i=>i.trim()).filter(i=>i);console.log("  - Bay numbers:",s),u.value=s.map(i=>({id:`bay${i}`,name:`Bay ${i}`})),console.log("  - 已选中的 Bays:",u.value)}}else console.error("❌ 未找到部门数据"),console.log("Store 中的所有部门:",m.departments),b.error("Failed to load department data")}});const L=()=>{A.push("/Departments")},G=async()=>{if(!g.value.trim()){b.warning("Please enter a department name");return}const o=u.value.map(s=>s.name.replace("Bay ","")).join(", "),e=y.value.map(s=>s.id).join(",");let l=null;if(f.value&&p.value>=0&&(l=m.departments[p.value]),f.value&&p.value>=0){const s={id:(l==null?void 0:l.id)||0,name:g.value.trim(),locker:B.value.trim(),locker_id:(l==null?void 0:l.locker_id)||0,detail:C.value.trim(),user_list:e||(l==null?void 0:l.user_list)||"",assignedBays:o,devices:u.value.length>0?u.value.length.toString():E.value,category:(l==null?void 0:l.category)||"A1",expanded:(l==null?void 0:l.expanded)||!1};try{await m.editDepartment(s),b.success("Department updated successfully"),A.push("/Departments")}catch(i){b.error("Failed to update department: "+(i.message||"Unknown error"));return}}else{const s={name:g.value.trim(),locker:B.value.trim(),locker_id:0,detail:C.value.trim(),user_list:e||"",assignedBays:o,devices:u.value.length>0?u.value.length.toString():E.value,category:"A1"};try{await m.addDepartment(s),b.success("Department added successfully"),A.push("/Departments")}catch(i){b.error("Failed to add department: "+(i.message||"Unknown error"));return}}},J=()=>{U.value=!1,p.value>=0&&(m.deleteDepartment(p.value),b.success("Department deleted successfully")),A.push("/Departments")},K=o=>{const e=y.value.findIndex(l=>l.id===o.id);e>-1&&y.value.splice(e,1)},P=o=>_.value.some(e=>e.id===o.id),H=o=>{const e=_.value.findIndex(l=>l.id===o.id);e>-1?_.value.splice(e,1):_.value.push(o)},O=()=>{y.value=[..._.value],x.value=!1},Q=()=>{x.value=!1,_.value=[...y.value]},W=()=>{_.value=[...y.value],x.value=!0},X=o=>{const e=u.value.findIndex(l=>l.id===o.id);e>-1&&u.value.splice(e,1)},Y=o=>k.value.some(e=>e.id===o.id),Z=o=>{const e=k.value.findIndex(l=>l.id===o.id);e>-1?k.value.splice(e,1):k.value.push(o)},ee=()=>{u.value=[...k.value],S.value=!1},le=()=>{S.value=!1,k.value=[...u.value]},te=()=>{k.value=[...u.value],S.value=!0};return(o,e)=>{const l=w("el-icon"),s=w("el-button"),i=w("el-input"),R=w("el-tag"),q=w("el-dialog");return v(),D("div",me,[a("div",pe,[d(s,{type:"text",class:"back-btn",onClick:L},{default:n(()=>[d(l,null,{default:n(()=>[d(re(ie))]),_:1})]),_:1}),a("h1",ve,V(h.value),1),e[8]||(e[8]=a("div",{class:"header-spacer"},null,-1))]),e[25]||(e[25]=a("p",{class:"page-description"},"Assign User to Assigned department.",-1)),a("div",fe,[e[9]||(e[9]=a("label",{class:"form-label"},"Department",-1)),d(i,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"Enter department name",class:"department-name-input"},null,8,["modelValue"])]),a("div",ge,[e[10]||(e[10]=a("label",{class:"form-label"},"Locker",-1)),d(i,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=t=>B.value=t),placeholder:"Enter locker name",class:"locker-name-input"},null,8,["modelValue"])]),a("div",ye,[e[11]||(e[11]=a("label",{class:"form-label"},"Department Description",-1)),d(i,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),type:"textarea",rows:3,placeholder:"Enter department description",class:"department-description-input"},null,8,["modelValue"])]),a("div",_e,[e[13]||(e[13]=a("label",{class:"form-label"},"User",-1)),a("div",ke,[(v(!0),D($,null,N(y.value,t=>(v(),M(R,{key:t.id,closable:"",class:"item-tag",onClose:F=>K(t)},{default:n(()=>[c(V(t.name),1)]),_:2},1032,["onClose"]))),128))]),d(s,{type:"primary",class:"add-manage-btn",onClick:W},{default:n(()=>[...e[12]||(e[12]=[c(" Add Manage ",-1)])]),_:1})]),a("div",be,[e[15]||(e[15]=a("label",{class:"form-label"},"Assigned Bays",-1)),a("div",De,[(v(!0),D($,null,N(u.value,t=>(v(),M(R,{key:t.id,closable:"",class:"item-tag",onClose:F=>X(t)},{default:n(()=>[c(V(t.name),1)]),_:2},1032,["onClose"]))),128))]),d(s,{type:"primary",class:"add-manage-btn",onClick:te},{default:n(()=>[...e[14]||(e[14]=[c(" Add Manage ",-1)])]),_:1})]),a("div",Be,[d(s,{class:"save-btn-bottom",onClick:G},{default:n(()=>[...e[16]||(e[16]=[c("Save",-1)])]),_:1}),f.value?(v(),M(s,{key:0,class:"delete-btn",onClick:e[3]||(e[3]=t=>U.value=!0)},{default:n(()=>[...e[17]||(e[17]=[c("Delete",-1)])]),_:1})):ue("",!0)]),d(q,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=t=>x.value=t),title:"Select Users",width:"700px",color:"#000","close-on-click-modal":!1,"custom-class":"custom-selection-dialog",style:{"font-weight":"600"}},{footer:n(()=>[a("span",xe,[d(s,{type:"default",class:"cancel-btn",onClick:Q},{default:n(()=>[...e[18]||(e[18]=[c("Cancel",-1)])]),_:1}),d(s,{type:"primary",class:"save-btn",onClick:O},{default:n(()=>[...e[19]||(e[19]=[c("Save",-1)])]),_:1})])]),default:n(()=>[a("div",Ce,[(v(!0),D($,null,N(j.value,t=>(v(),D("div",{key:t.id,class:T(["selection-card",{selected:P(t)}]),onClick:F=>H(t)},V(t.name),11,Ue))),128))])]),_:1},8,["modelValue"]),d(q,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=t=>S.value=t),title:"Select Assigned Bays",width:"700px",color:"#000","close-on-click-modal":!1,"custom-class":"custom-selection-dialog",style:{"font-weight":"600"}},{footer:n(()=>[a("span",Ve,[d(s,{type:"default",class:"cancel-btn",onClick:le},{default:n(()=>[...e[20]||(e[20]=[c("Cancel",-1)])]),_:1}),d(s,{type:"primary",class:"save-btn",onClick:ee},{default:n(()=>[...e[21]||(e[21]=[c("Save",-1)])]),_:1})])]),default:n(()=>[a("div",Se,[(v(!0),D($,null,N(z.value,t=>(v(),D("div",{key:t.id,class:T(["selection-card",{selected:Y(t)}]),onClick:F=>Z(t)},V(t.name),11,we))),128))])]),_:1},8,["modelValue"]),d(q,{modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=t=>U.value=t),title:"Confirm Delete",width:"400px"},{footer:n(()=>[d(s,{onClick:e[6]||(e[6]=t=>U.value=!1)},{default:n(()=>[...e[22]||(e[22]=[c("Cancel",-1)])]),_:1}),d(s,{type:"danger",onClick:J},{default:n(()=>[...e[23]||(e[23]=[c("Delete",-1)])]),_:1})]),default:n(()=>[e[24]||(e[24]=a("p",null,"Are you sure you want to delete this department?",-1))]),_:1},8,["modelValue"])])}}},qe=se(Ie,[["__scopeId","data-v-72fe086c"]]);export{qe as default};

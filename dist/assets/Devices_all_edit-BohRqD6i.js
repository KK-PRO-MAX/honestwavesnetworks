import{_ as le,J as ae,D as te,R as oe,r as d,c as se,o as de,a as I,b as c,d as i,e as a,w as t,u as l,K as ie,i as R,t as T,S as M,T as k,U as w,j as q,f as O,F as U,l as $,G as B,E as j,h as v,g as f,y as ne,V as ue,W as re,X as G,n as ce,m as u}from"./index-COfldkwK.js";import{u as ve}from"./deviceStore-BOybtG8z.js";import{u as fe}from"./deviceTypeStore-ACL_ysHU.js";import{g as pe}from"./locker-B9bkZgAW.js";import"./device-p3qppuv_.js";import"./index-B9ygI19o.js";const ye={class:"add-device-page"},me={class:"page-header"},_e={class:"page-title"},ge={class:"footer-buttons"},be={class:"dialog-content text-center"},De={class:"dialog-text"},ke={style:{"font-weight":"700",color:"#000 !important"}},we={class:"bay-buttons-grid"},Se={__name:"Devices_all_edit",setup(Ce){const F=ae(),r=te(),x=ve(),A=fe(),J=()=>F.back(),{deviceTypeList:z}=oe(A),{loadDeviceTypeList:K}=A,p=d([]),S=d(!1),L=d("Add New Device"),C=d(0),y=d(""),_=d(""),g=d(null),V=d(""),m=d(0),n=d(null),E=d(!1),b=d(""),N=d(!1),D=d(!1),P=se(()=>{if(!n.value||!p.value||p.value.length===0)return 0;const s=p.value.find(e=>e.id===n.value);return(s==null?void 0:s.bay_total)||0}),W=async()=>{var s;try{await K(),console.log("Device types loaded:",((s=z.value)==null?void 0:s.length)||0)}catch(e){console.error("Failed to load device types:",e),u.error("Failed to load device types")}},X=async()=>{var s;try{const e=await pe();if(e.data&&e.data.ret===0)p.value=Array.isArray(e.data.ret_data)?e.data.ret_data:[],console.log("Lockers loaded:",p.value.length);else throw new Error(((s=e.data)==null?void 0:s.msg)||"Failed to load locker list")}catch(e){console.error("Failed to load locker list:",e),u.error("Failed to load locker list"),p.value=[]}};de(async()=>{await Promise.all([W(),X()]),r.query.mode==="edit"?(S.value=!0,C.value=parseInt(String(r.query.id))||0,_.value=String(r.query.device_id)||"",y.value=String(r.query.device_name)||"",g.value=parseInt(String(r.query.device_type_id))||null,V.value=String(r.query.device_nfc_code)||"",m.value=parseInt(String(r.query.cabinet_no))||0,n.value=parseInt(String(r.query.locker_id))||null,L.value=`Edit ${y.value}`):(S.value=!1,L.value="Add New Device")});const h=s=>s.toString().padStart(2,"0"),H=()=>{if(!n.value){u.warning("Please select a Locker first");return}if(P.value===0){u.warning("Selected locker has no available bays");return}E.value=!0},Q=()=>{b.value="",E.value=!1},Y=()=>{b.value&&(m.value=parseInt(b.value)),E.value=!1,b.value=""},Z=async()=>{if(!y.value||!_.value||!g.value||m.value<=0||!n.value){u.warning("Please fill in all required fields");return}D.value=!0;try{if(S.value){if(C.value<=0){u.error("Invalid device ID");return}const s={id:C.value,device_id:_.value,device_name:y.value,device_type_id:g.value,device_nfc_code:V.value,cabinet_no:m.value,locker_id:n.value};await x.updateDevice(s),u.success("Device updated successfully")}else{const s={device_id:_.value,device_name:y.value,device_type_id:g.value,device_nfc_code:V.value,cabinet_no:m.value,locker_id:n.value};await x.addDevice(s),u.success("Device added successfully")}setTimeout(()=>{F.push("/devices")},500)}catch(s){console.error("Failed to save device:",s)}finally{D.value=!1}},ee=async()=>{if(S.value&&C.value>0){D.value=!0;try{await x.deleteDevice(C.value),u.success("Device deleted successfully"),setTimeout(()=>{F.push("/devices")},500)}catch(s){console.error("Failed to delete device:",s)}finally{D.value=!1}}N.value=!1};return(s,e)=>(c(),I("div",ye,[i("div",me,[a(l(R),{class:"back-arrow",onClick:J},{default:t(()=>[a(l(ie))]),_:1}),i("h1",_e,T(L.value),1)]),a(l(ue),{class:"device-form","label-position":"top"},{default:t(()=>[a(l(M),{gutter:24},{default:t(()=>[a(l(k),{span:8},{default:t(()=>[a(l(w),{label:"Device Name *"},{default:t(()=>[a(l(q),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o),placeholder:"Enter Device Name"},null,8,["modelValue"])]),_:1})]),_:1}),a(l(k),{span:8},{default:t(()=>[a(l(w),{label:"Device ID *"},{default:t(()=>[a(l(q),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=o=>_.value=o),placeholder:"Enter Device ID"},null,8,["modelValue"])]),_:1})]),_:1}),a(l(k),{span:8},{default:t(()=>[a(l(w),{label:"Device Type "},{default:t(()=>[a(l(O),{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=o=>g.value=o),placeholder:"Select Device Type",filterable:"",style:{width:"100%"}},{default:t(()=>[(c(!0),I(U,null,$(l(z),o=>(c(),B(l(j),{key:o.id,label:`${o.device_type} (${o.device_type_code_id})`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(l(M),{gutter:24},{default:t(()=>[a(l(k),{span:8},{default:t(()=>[a(l(w),{label:"Cabinet No*"},{default:t(()=>[e[9]||(e[9]=i("div",{class:"form-note"},"Note: Select the cabinet/bay for this device",-1)),a(l(v),{class:"select-bay-btn",type:"text",disabled:!n.value,onClick:H},{default:t(()=>[f(T(m.value>0?"Cabinet "+m.value:"Select Cabinet"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),a(l(k),{span:8},{default:t(()=>[a(l(w),{label:"Device NFC Code"},{default:t(()=>[e[10]||(e[10]=i("div",{class:"form-note"},"Note: Enter or scan the NFC code",-1)),a(l(q),{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=o=>V.value=o),placeholder:"Enter or scan the NFC code"},null,8,["modelValue"])]),_:1})]),_:1}),a(l(k),{span:8},{default:t(()=>[a(l(w),{label:"Locker "},{default:t(()=>[e[11]||(e[11]=i("div",{class:"form-note",style:{visibility:"hidden"}},"Note: Placeholder for alignment",-1)),a(l(O),{modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value=o),placeholder:"Select Locker",filterable:"",style:{width:"100%"}},{default:t(()=>[(c(!0),I(U,null,$(p.value,o=>(c(),B(l(j),{key:o.id,label:`${o.name} (ID: ${o.id})`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),i("div",ge,[S.value?(c(),B(l(v),{key:0,size:"large",class:"delete-btn",loading:D.value,onClick:e[5]||(e[5]=o=>N.value=!0)},{default:t(()=>[...e[12]||(e[12]=[f("Delete",-1)])]),_:1},8,["loading"])):ne("",!0),a(l(v),{type:"primary",size:"large",class:"save-btn",loading:D.value,onClick:Z},{default:t(()=>[...e[13]||(e[13]=[f("Save",-1)])]),_:1},8,["loading"])])]),_:1}),a(l(G),{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=o=>N.value=o),title:"Are you Sure?",width:"450px",center:!0},{footer:t(()=>[a(l(v),{onClick:e[6]||(e[6]=o=>N.value=!1)},{default:t(()=>[...e[16]||(e[16]=[f("Cancel",-1)])]),_:1}),a(l(v),{type:"danger",onClick:ee},{default:t(()=>[...e[17]||(e[17]=[f("Delete",-1)])]),_:1})]),default:t(()=>[i("div",be,[a(l(R),{class:"dialog-icon",style:{"font-size":"45px",color:"#ff4d4f","margin-bottom":"18px"}},{default:t(()=>[a(l(re))]),_:1}),i("p",De,[e[14]||(e[14]=i("strong",{style:{display:"block","font-size":"1.8rem","margin-bottom":"18px"}},"Are you Sure?",-1)),i("strong",ke,'Do you really want to delete this Device "'+T(s.deviceName)+'"?',1)]),e[15]||(e[15]=i("p",{class:"dialog-text",style:{"font-weight":"700",color:"#000 !important"}},"This process cannot be Undone.",-1))])]),_:1},8,["modelValue"]),a(l(G),{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=o=>E.value=o),title:"Select Bay",width:"800px","close-on-click-modal":!1},{footer:t(()=>[a(l(v),{class:"tan",onClick:Q},{default:t(()=>[...e[18]||(e[18]=[f("Cancel",-1)])]),_:1}),a(l(v),{type:"primary",style:{background:"#0f3460",color:"#fff"},class:"tan",onClick:Y},{default:t(()=>[...e[19]||(e[19]=[f(" Save ",-1)])]),_:1})]),default:t(()=>[e[20]||(e[20]=i("div",{class:"bay-dialog-note"}," Please select the bay you want the device to be assigned to ",-1)),i("div",we,[(c(!0),I(U,null,$(P.value,o=>(c(),B(l(v),{key:o,class:ce(["bay-btn",{"bay-btn-selected":b.value===h(o)}]),onClick:Ve=>b.value=h(o)},{default:t(()=>[f(T(h(o)),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1},8,["modelValue"])]))}},xe=le(Se,[["__scopeId","data-v-bc64c511"]]);export{xe as default};
